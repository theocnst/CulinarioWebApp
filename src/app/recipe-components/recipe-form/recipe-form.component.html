<div class="min-h-screen bg-gray-100 p-4 sm:p-12">
  <div
    class="mx-auto max-w-lg border-0 bg-white px-6 py-12 shadow-lg sm:rounded-3xl"
  >
    <div class="container mx-auto p-4">
      <h2 class="mb-4 text-2xl">
        {{ recipe.recipeId ? "Editing " + recipe.name : "Create a New Recipe" }}
      </h2>
      <form (ngSubmit)="onSubmit()">
        <!-- Step 1: Basic Info -->
        @if (currentStep === 1) {
          <div>
            <div class="relative z-0 mb-4 w-full">
              <input
                type="text"
                name="name"
                placeholder=" "
                required
                class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                [(ngModel)]="recipe.name"
              />
              <label
                class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                >Name</label
              >
            </div>
            <div class="relative z-0 mb-4 w-full">
              <input
                type="text"
                name="image"
                placeholder=" "
                required
                class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                [(ngModel)]="recipe.image"
              />
              <label
                class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                >Image URL</label
              >
            </div>
            <div class="mb-4">
              <div class="mb-2 flex space-x-4">
                <label
                  class="w-1/4 text-center text-sm font-medium text-gray-700"
                  >Prep Time (minutes)</label
                >
                <label
                  class="w-1/4 text-center text-sm font-medium text-gray-700"
                  >Cook Time (minutes)</label
                >
                <label
                  class="w-1/4 text-center text-sm font-medium text-gray-700"
                  >Total Time (minutes)</label
                >
                <label
                  class="w-1/4 text-center text-sm font-medium text-gray-700"
                  >Servings</label
                >
              </div>
              <div class="flex space-x-4">
                <input
                  class="w-1/4 rounded border p-2 text-gray-800"
                  type="number"
                  [(ngModel)]="recipe.prepTime"
                  name="prepTime"
                  required
                />
                <input
                  class="w-1/4 rounded border p-2 text-gray-800"
                  type="number"
                  [(ngModel)]="recipe.cookTime"
                  name="cookTime"
                  required
                />
                <input
                  class="w-1/4 rounded border p-2 text-gray-800"
                  type="number"
                  [(ngModel)]="recipe.totalTime"
                  name="totalTime"
                  required
                />
                <input
                  class="w-1/4 rounded border p-2 text-gray-800"
                  type="number"
                  [(ngModel)]="recipe.servings"
                  name="servings"
                  required
                />
              </div>
            </div>

            <div class="relative z-0 mb-4 w-full">
              <textarea
                name="description"
                placeholder=" "
                required
                class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                [(ngModel)]="recipe.description"
              ></textarea>
              <label
                class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                >Description</label
              >
            </div>
            <div class="relative z-0 mb-4 w-full">
              @if (!isEditing) {
                <div class="relative z-0 w-full" (dblclick)="enableEdit()">
                  <select
                    name="countryName"
                    required
                    class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                    [(ngModel)]="recipe.countryName"
                  >
                    <option value="" selected disabled hidden></option>
                    @for (country of countries; track country.countryName) {
                      <option [value]="country.countryName">
                        {{ country.countryName }}
                      </option>
                    }
                  </select>
                  <label
                    class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                    >Country</label
                  >
                </div>
              } @else {
                <div class="relative z-0 w-full">
                  <input
                    type="text"
                    name="countryNameInput"
                    placeholder="Enter Country"
                    required
                    class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                    [(ngModel)]="recipe.countryName"
                    (blur)="disableEdit()"
                  />
                  <label
                    class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                    >Enter Country</label
                  >
                </div>
              }
            </div>

            <div class="relative z-0 mb-4 w-full">
              <select
                name="recipeType"
                placeholder=" "
                required
                class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                [(ngModel)]="recipe.recipeType.name"
              >
                <option value="" selected disabled hidden></option>
                @for (type of recipeTypes; track type) {
                  <option [value]="type.name">{{ type.name }}</option>
                }
              </select>
              <label
                class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                >Recipe Type</label
              >
            </div>
          </div>
        }

        <!-- Step 2: Ingredients -->
        @if (currentStep === 2) {
          <div>
            <div class="mb-4">
              <label class="mb-4 block text-lg font-medium">Ingredients</label>
              @for (
                ingredient of recipe.ingredients;
                track ingredient;
                let i = $index
              ) {
                <div class="flex">
                  <div class="relative z-0 m-4 mb-2 w-full">
                    <input
                      type="text"
                      name="ingredientName{{ i }}"
                      placeholder=" "
                      required
                      class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                      [(ngModel)]="recipe.ingredients[i].name"
                    />
                    <label
                      class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                      >Name</label
                    >
                  </div>
                  <div class="relative z-0 m-4 mb-2 w-28">
                    <input
                      type="number"
                      name="ingredientQuantity{{ i }}"
                      placeholder=" "
                      required
                      class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 text-center focus:border-black focus:outline-none focus:ring-0"
                      [(ngModel)]="recipe.ingredients[i].quantity"
                    />
                    <label
                      class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                      >Quantity</label
                    >
                  </div>
                  <div class="relative z-0 m-4 mb-2 w-36">
                    <input
                      type="text"
                      name="ingredientUnit{{ i }}"
                      placeholder=" "
                      required
                      class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                      [(ngModel)]="recipe.ingredients[i].unit"
                    />
                    <label
                      class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                      >Unit</label
                    >
                  </div>
                  <button
                    type="button"
                    class="mt-5 h-9 rounded-xl bg-red-500 px-4 text-white"
                    (click)="removeIngredient(i)"
                  >
                    X
                  </button>
                </div>
              }
              <button
                type="button"
                class="w-full rounded bg-purple-400 px-4 py-2 text-white"
                (click)="addIngredient()"
              >
                Add Ingredient
              </button>
            </div>
          </div>
        }

        <!-- Step 3: Instructions -->
        @if (currentStep === 3) {
          <div>
            <div class="mb-4">
              <label class="mb-4 block text-lg font-medium">Instructions</label>
              @for (
                instruction of recipe.instructions;
                track instruction;
                let i = $index
              ) {
                <div class="mb-4 flex items-start">
                  <span
                    class="block w-12 pt-3 text-center font-semibold text-gray-700"
                    >Step {{ recipe.instructions[i].stepNumber }}</span
                  >
                  <div class="relative mx-4 flex-1">
                    <textarea
                      name="instructionDescription{{ i }}"
                      placeholder=" "
                      required
                      class="block w-full rounded-lg border-2 border-gray-200 bg-transparent px-3 py-2 focus:border-black focus:outline-none focus:ring-0"
                      [(ngModel)]="recipe.instructions[i].description"
                    ></textarea>
                    <label
                      class="absolute left-3 top-2 -translate-y-1/2 transform text-gray-500 transition-all duration-300"
                    >
                    </label>
                  </div>
                  <button
                    type="button"
                    class="mt-3 h-9 rounded-xl bg-red-500 px-4 text-white"
                    (click)="removeInstruction(i)"
                  >
                    X
                  </button>
                </div>
              }
              <button
                type="button"
                class="w-full rounded bg-purple-400 px-4 py-2 text-white"
                (click)="addInstruction()"
              >
                Add Instruction
              </button>
            </div>
          </div>
        }

        <!-- Step 4: Nutrition Info -->
        @if (currentStep === 4) {
          <div>
            <div class="mb-4">
              <label class="mb-4 block text-lg font-medium"
                >Nutrition Info</label
              >
              <div class="relative z-0 mb-4 w-full">
                <input
                  type="number"
                  name="calories"
                  placeholder=" "
                  required
                  class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                  [(ngModel)]="recipe.nutritionInfo.calories"
                />
                <label
                  class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                  >Calories</label
                >
              </div>
              <div class="relative z-0 mb-4 w-full">
                <input
                  type="number"
                  name="fats"
                  placeholder=" "
                  required
                  class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                  [(ngModel)]="recipe.nutritionInfo.fats"
                />
                <label
                  class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                  >Fats</label
                >
              </div>
              <div class="relative z-0 mb-4 w-full">
                <input
                  type="number"
                  name="carbs"
                  placeholder=" "
                  required
                  class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                  [(ngModel)]="recipe.nutritionInfo.carbs"
                />
                <label
                  class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                  >Carbs</label
                >
              </div>
              <div class="relative z-0 mb-4 w-full">
                <input
                  type="number"
                  name="protein"
                  placeholder=" "
                  required
                  class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                  [(ngModel)]="recipe.nutritionInfo.protein"
                />
                <label
                  class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                  >Protein</label
                >
              </div>
              <div class="relative z-0 mb-4 w-full">
                <input
                  type="number"
                  name="fiber"
                  placeholder=" "
                  required
                  class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                  [(ngModel)]="recipe.nutritionInfo.fiber"
                />
                <label
                  class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                  >Fiber</label
                >
              </div>
              <div class="relative z-0 mb-4 w-full">
                <input
                  type="number"
                  name="sugar"
                  placeholder=" "
                  required
                  class="mt-0 block w-full appearance-none border-0 border-b-2 border-gray-200 bg-transparent px-0 pb-2 pt-3 focus:border-black focus:outline-none focus:ring-0"
                  [(ngModel)]="recipe.nutritionInfo.sugar"
                />
                <label
                  class="-z-1 origin-0 absolute top-3 text-gray-500 duration-300"
                  >Sugar</label
                >
              </div>
            </div>
          </div>
        }

        <!-- Navigation Buttons -->
        <div class="flex justify-between">
          <button
            type="button"
            class="rounded bg-gray-500 px-4 py-2 text-white"
            (click)="prevStep()"
            [disabled]="currentStep === 1"
          >
            Back
          </button>
          @if (currentStep < 4) {
            <button
              type="button"
              class="rounded bg-blue-500 px-4 py-2 text-white"
              (click)="nextStep()"
            >
              Next
            </button>
          }
          @if (currentStep === 4) {
            <button
              type="submit"
              class="rounded bg-green-500 px-4 py-2 text-white"
            >
              Submit
            </button>
          }
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal for validation errors -->
@if (errorMessage) {
  <div class="fixed inset-0 z-10 overflow-y-auto">
    <div
      class="flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0"
    >
      <div class="fixed inset-0 transition-opacity" aria-hidden="true">
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
      </div>
      <span
        class="hidden sm:inline-block sm:h-screen sm:align-middle"
        aria-hidden="true"
        >&#8203;</span
      >
      <div
        class="inline-block transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle"
      >
        <div class="sm:flex sm:items-start">
          <div
            class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
          >
            <svg
              class="h-6 w-6 text-red-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </div>
          <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
            <h3
              class="text-lg font-medium leading-6 text-gray-900"
              id="modal-title"
            >
              Validation Error
            </h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">{{ errorMessage }}</p>
            </div>
          </div>
        </div>
        <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
          <button
            (click)="closeModal()"
            type="button"
            class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
}
